<html>
    <head>
        <style>
            .wrap {
                padding-top: 100px;
                transform: rotate3d(1, 0.666, 0, 45deg);
            }
            .elem {
                width: 100px;
                height: 40px;
                background-color: green;
            }
            .holder {
                margin-top: 50px;
            }
        </style>
    </head>
    <body>
        <!-- <svg class="sv" viewBox="0 0 200 200" style="width:600px;height:400px"> -->
            <!-- <line x1="0" y1="0" x2="20" y2="20" stroke="green" />
            <line x1="0" y1="0" x2="20" y2="20" stroke="green" />
            <line x1="0" y1="0" x2="20" y2="20" stroke="green" />
            <line x1="0" y1="0" x2="20" y2="20" stroke="green" />
            <line x1="0" y1="0" x2="20" y2="20" stroke="green" /> -->
        <!-- </svg> -->

        <div class="holder" style="transform-origin: 0px 0px;transform: rotateX(30deg) rotateY(45deg);transform-style: preserve-3d;">
        </div>

        <button onclick="pause()">pause</button>
        <script>
            const scalar = 4;
            const snakeWidth = 20;
            const curveAmnt = snakeWidth * 5;
            const snakeElementLength = snakeWidth * scalar;
            const widthToHeight = w => (16 / 20) * w;
            
            const snakeElementHeight = widthToHeight(snakeWidth) * scalar;
            const numElements = 10;
            // const snakeText = 'Happy Mothers Day!'.toUpperCase().split('').reverse().join('');
            const snakeText = 'Happy Mothers Day!'.toUpperCase();


            const elements = Array.from({ length: numElements}, (_, index) => {
                // const el = document.createElementNS('http://www.w3.org/2000/svg','line');
                // el.setAttribute('x1', snakeElementLength * index);
                // el.setAttribute('y1', '10');
                // el.setAttribute('x2', (index + 1) * snakeElementLength);
                // el.setAttribute('y2', '10');
                // el.setAttribute('stroke', 'green');

                const el2 = document.createElement('div');
                el2.style.width = `${snakeElementLength}px`;
                el2.style.height = `${snakeElementHeight}px`;
                el2.style.position = 'absolute';
                el2.style.display = 'flex';
                el2.style.justifyContent = 'center';
                el2.style.alignItems = 'center';

                el2.style.top = '0px';
                el2.style.left = '0px';
                let setText = (str, col = 'red') => el2.innerHTML = `<div style="color:${col};font-family:helvetica;font-size:40px;display:flex;justify-content:center;align-items:center;">${str}</div>`;

                let setElColor = (c) => el2.style.backgroundColor = c;
                // el2.style.transformStyle = 'preserve-3d';

                if (index === 0) {
                    const head = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    head.setAttribute('viewBox', "0 0 100 100");
                    // head.style.width =  '100%';
                    head.style.height = '100%';
                    head.style.display = 'block';
                    const headPath = document.createElementNS('http://www.w3.org/2000/svg','path');
                    headPath.setAttribute('fill', 'black');
                    headPath.setAttribute('d', 'M 15 50 L 100 120 L 100 -20 Z');

                    head.appendChild(headPath);
                    el2.appendChild(head);
                    el2.style.display = 'flex';
                    el2.style.justifyContent = 'flex-end';
                    setElColor = (c) => headPath.setAttribute('fill', c);

                    const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
                    circle.setAttribute('r', '10');
                    circle.setAttribute('fill', 'black');
                    circle.setAttribute('cx', '60');
                    circle.setAttribute('cy', '30');
                    head.appendChild(circle);

                    function addLine(x1, y1, x2, y2, col = 'pink') {
                        const p = document.createElementNS('http://www.w3.org/2000/svg','line');
                        p.setAttribute('x1', x1);
                        p.setAttribute('x2', x2);
                        p.setAttribute('y1', y1);
                        p.setAttribute('y2', y2);
                        p.setAttribute('stroke', col);
                        p.setAttribute('stroke-width', '4');
                        head.appendChild(p);
                    }

                    addLine(15, 50, 5, 50, 'pink');
                    addLine(0, 40, 5, 50, 'pink');
                    addLine(0, 60, 5, 50, 'pink');


                    // el2.innerHTML = `
                    //     <svg viewBox="0 0 100 100" style="width:100%;height:100%;">
                    //         <path stroke="green" d="M 0 50 L 100 120 L 100 -20 Z" />
                    //     </svg>
                    // `;
                }


                // const svgE = document.querySelector('.sv');
                const holder = document.querySelector('.holder');

                // svgE.appendChild(el);
                holder.appendChild(el2);
                return {
                    // el,
                    el2,
                    index,
                    setElColor,
                    setText,
                };
            });

            function point2VecAngle(p1, p2) {
                const diff = { x: p2.x - p1.x, y: p2.y - p1.y };
                const m = Math.sqrt(diff.x * diff.x + diff.y * diff.y);
                const vec = { x: diff.x / m, y: diff.y / m };
                const angle = Math.atan2(vec.y, vec.x) * 57.3;
                return {
                    p1,
                    width: m,
                    angle: 360-angle,
                };
            }

            let t = 0;
            const SWLEN = Math.PI * 2;
            const animLen = 1000;
            const FRAMES = 60;
            const snakeLen = numElements * snakeElementLength;
            let textT = 0, textTi = 0;
            let interv = setInterval(() => {
                const tlevel = SWLEN * t / 1000;
                function getHeight(i) {
                    return Math.sin(i + t) * curveAmnt + 100;
                }
                elements.forEach(e => {
                    const i = -(e.index / numElements) * SWLEN;
                    const i2 = -((e.index + 1) / numElements) * SWLEN;
                    const h1 = getHeight(i);
                    const h2 = getHeight(i2);
                    // e.el.setAttribute('y1', h1);
                    // e.el.setAttribute('y2', h2);
                    const p1 = {
                        x: e.index * snakeElementLength,
                        y: h1,
                    };
                    const p2 = {
                        x: (e.index + 1) * snakeElementLength,
                        y: h2,
                    };

                    const diff = { x: p2.x - p1.x, y: p2.y - p1.y };
                    const magScalar = 1 / Math.sqrt(diff.x * diff.x + diff.y * diff.y);
                    const vec = { x: diff.x * magScalar, y: diff.y * magScalar };
                    const normal = { x: -vec.y, y: vec.x };
                    const greenScalar = (1 - Math.abs(normal.x)) * 255;
                    const greenScalar2 = Math.min(greenScalar * 0.5, 255);
                    const hex = Math.floor(greenScalar).toString(16);
                    const hexDarker = Math.floor(greenScalar2).toString(16);
                    // e.el.setAttribute('stroke', `#00${hex}00`);
                    // console.log(greenScalar, greenScalar2, hex, hexDarker);

                    const arbot = point2VecAngle(p1, p2);
                    e.el2.style.width = `${arbot.width}px`;
                    // console.log(arbot.angle);
                    // e.el2.style.transform = `translate3d(${arbot.p1.x}px, 0px, ${arbot.p1.y}) rotateY(${arbot.angle}deg)`;
                    e.el2.style.transform = `translate3d(${arbot.p1.x}px, 0px, ${arbot.p1.y}px) rotateY(${arbot.angle}deg)`;
                    // e.el2.style.transform = `rotateY(${40}deg)`;
                    e.el2.style.transformOrigin = `0px 0px`;
                    // e.el2.style.backgroundColor = `#00${hex}00`;
                    e.setElColor(`#00${hex}00`);
                    // const letterIndex = textTi + (elements.length - e.index - 2);
                    const letterIndex = textTi + (e.index - 1);
                    if (e.index !== 0) {
                        const letter = letterIndex < snakeText.length ? snakeText.charAt(letterIndex) : '';
                        e.setText(letter, `#00${hexDarker}00`);
                    }
                });
                t = (t + 0.2) % 1000;
                if (textT === 0) {
                    textTi = (textTi + 1) % (snakeText.length - 1);
                }
                textT = (textT + 1) % 5;
            }, 60);

            function pause() {
                clearInterval(interv);
            }

        
        </script>



    </body>
</html>